# futex
## abbr
It stands for fast user-space mutex.

## Prequisite
These are about OS.

Although they may be abstract for you as a reader, they are important in computer science. 

I hope they can help you a lot even if you do NOT study in computer science.

1. mutex
2. semaphore
3. basic concepts of multithreading.
4. basic concepts of multithread execution.
5. basic concepts of atomic operation.
6. basic concepts of wait queue in OS.

## Recall 

1. Recall about the mutex.

Assume the mutex is atomic. (For more details about atomic, see next point in recall section. )

Mutex behaves like a lock.

It can block a task, or a process (,or precisely said, a thread) so that it makes sure that they are executed in order (or saying, as we expected).

Threads which are generated by the same program may NOT executed in order (or saying, as we expected) in general case (, or precisely said, when we do NOT use the

technique as mutex blocking )

You will understand it more after you understand the basic concepts of multithreading and multithread execution.

2. Recall about the atomic operation.

The word atomic refers something NOT be splitted into smaller units. 

Atomic operation refers the operation can NOT be interrupted when execution.

## intro 

Assume the mutex is atomic. (For more details about atomic, see next point in recall section. )

If the mutex is NOT atomic, all features may NOT be true.

Futex is a type of mutex.

It consists of a kernel-space wait queue that is attached to an atomic integer in user space.

A process can be slept or woken up by a system call in futex. (For more details, see the following section)

## Operation
There are two basic operations.

      1. WAIT()
      
      2. WAKE()
      
1. WAIT(addr, val)
  
        If the value stored at the address addr is val, puts the current thread to sleep.
        
2. WAKE(addr, num)

        Wakes up num number of threads waiting on the address addr.
      
      
Here, I also list some advanced operations.

      1. CMP_REQUEUE()
      

      
      2. WAKE_OP()


1. CMP_REQUEUE(old_addr, new_addr, num_wake, num_move, val)

        If the value stored at the address old_addr is val
        
        , then wakes num_wake threads waiting on the address old_addr
        
        , and enqueues num_move threads waiting on the address old_addr to now wait on the address new_addr.
        
2. WAKE_OP(addr1, addr2, num1, num2, op, op_arg, cmp, cmp_arg)

        It will read addr2
        
        , then perform op with op_arg on it
        
        , and storing the result back to addr2. 
        
        Then it will wake num1 threads waiting on addr1
        
        , and, if the previously read value from addr2 matches cmp_arg using comparison cmp
        
        , then it will wake num2 threads waiting on addr2.
        
## Ref
https://en.wikipedia.org/wiki/Futex

https://www.man7.org/linux/man-pages/man7/futex.7.html

https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Atomics
